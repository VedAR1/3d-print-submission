<!DOCTYPE html>
<html>
<head>
  <title>3D Print Submission</title>
  <style>
    body { font-family: Arial; max-width: 700px; margin: auto; }
    label { display:block; margin-top:10px; }
    small { color: #555; }
  </style>
</head>
<body>

<h2>3D Print Submission</h2>

<label>Name</label>
<input id="name" required>

<label>Student ID</label>
<input id="studentId" required>

<label>3D File (STL or OBJ only)</label>
<input type="file" id="fileInput" accept=".stl,.obj" required>

<div id="dimensions"></div>

<h3>Print Settings</h3>

<label>Material <small>(PLA, PETG, etc.)</small></label>
<input id="material">

<label>Infill % <small>(How solid the part is inside)</small></label>
<input id="infill" type="number" value="15">

<label>Layer Height (mm) <small>(0.2 = standard quality)</small></label>
<input id="layerHeight" value="0.2">

<label>Supports <small>(Enable if your model has overhangs)</small></label>
<select id="supports">
  <option>No</option>
  <option>Yes</option>
</select>

<label>Brim <small>(Improves bed adhesion)</small></label>
<select id="brim">
  <option>No</option>
  <option>Yes</option>
</select>

<label>Notes (optional)</label>
<textarea id="notes"></textarea>

<br><br>
<button onclick="submitForm()">Submit</button>

<script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.158.0/examples/js/loaders/STLLoader.js"></script>
<script src="https://unpkg.com/three@0.158.0/examples/js/loaders/OBJLoader.js"></script>

<script>
let fileBase64 = "";
let dimX, dimY, dimZ;

document.getElementById("fileInput").addEventListener("change", handleFile);

function handleFile(e) {
  const file = e.target.files[0];
  const ext = file.name.split('.').pop().toLowerCase();
  if (!["stl", "obj"].includes(ext)) {
    alert("Only STL and OBJ files are supported.");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(event) {
    fileBase64 = event.target.result.split(",")[1];
    calculateDimensions(file, ext);
  };
  reader.readAsDataURL(file);
}

function calculateDimensions(file, ext) {
  const reader = new FileReader();
  reader.onload = function(e) {
    const loader = ext === "stl" ? new THREE.STLLoader() : new THREE.OBJLoader();
    const object = loader.parse(e.target.result);

    const box = new THREE.Box3().setFromObject(object);
    dimX = (box.max.x - box.min.x).toFixed(2);
    dimY = (box.max.y - box.min.y).toFixed(2);
    dimZ = (box.max.z - box.min.z).toFixed(2);

    document.getElementById("dimensions").innerHTML =
      `<b>Dimensions:</b> ${dimX} x ${dimY} x ${dimZ} mm<br><b>Please verify these are correct.</b>`;
  };
  reader.readAsArrayBuffer(file);
}

function submitForm() {
  const data = {
    name: name.value,
    studentId: studentId.value,
    fileName: fileInput.files[0].name,
    fileData: fileBase64,
    mimeType: fileInput.files[0].type,
    dimX, dimY, dimZ,
    material: material.value,
    infill: infill.value,
    layerHeight: layerHeight.value,
    supports: supports.value,
    brim: brim.value,
    notes: notes.value
  };

  fetch("PASTE_YOUR_APPS_SCRIPT_URL_HERE", {
    method: "POST",
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(res => {
    if (res.status === "success") {
      alert("Submission successful.");
    } else {
      alert("Error: " + res.message);
    }
  });
}
</script>

</body>
</html>
